FROM rds-vtc-docker-dev-local.vegistry.vg.vector.int/vcast/vscode_ubuntu24_ci:node_18_dynamic_mounting

ARG USERNAME=vcast_user
WORKDIR /home/${USERNAME}

# python
ARG PY_VERSION=3.10.12
ARG PY_VERSION_SHORT=3.10

RUN sudo apt-get update && sudo apt-get install libsqlite3-dev -y
RUN wget https://www.python.org/ftp/python/${PY_VERSION}/Python-${PY_VERSION}.tgz && \
    tar xvf Python-${PY_VERSION}.tgz && cd Python-${PY_VERSION} && sed -i 's/PKG_CONFIG openssl /PKG_CONFIG openssl /g' configure && \
    ./configure --enable-loadable-sqlite-extensions --enable-optimizations && sudo make && sudo make altinstall && \
    cd .. && sudo rm -rf Python-${PY_VERSION}* && \
    sudo update-alternatives --install /usr/bin/python3 python3 /usr/local/bin/python${PY_VERSION_SHORT} 1 && \
    rm -rf .venv

RUN mkdir -p /home/${USERNAME}/.scripts
COPY *.sh /home/${USERNAME}/.scripts/

SHELL ["/bin/bash", "--login", "-c"]