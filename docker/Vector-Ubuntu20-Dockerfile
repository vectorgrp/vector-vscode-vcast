FROM ubuntu:20.04

ARG PROXY_URL=http://gateway.zscloud.net:9480
ARG NO_PROXY="localhost,127.0.0.1,localaddress,.localdomain.com,0.0.0.0,::1,.vector.int,10.0.0.0/8,http://vapvdatg01.vi.vector.int/,https://vistrrdeart1.vi.vector.int/artifactory/"

ENV http_proxy=${PROXY_URL} \
    https_proxy=${PROXY_URL} \
    HTTP_PROXY=${PROXY_URL} \
    HTTPS_PROXY=${PROXY_URL} \
    no_proxy=${NO_PROXY} \
    DEBIAN_FRONTEND=noninteractive \
    TZ=Etc/UTC

# Install Vector certificates
ADD https://vistradpart1.vi.vector.int/artifactory/adp-globaltools-generic-prod/Vector_Root_2.0.crt /usr/local/share/ca-certificates/vector_root.crt
ADD https://vistradpart1.vi.vector.int/artifactory/adp-globaltools-generic-prod/Vector_Issuing_2.0.crt /usr/local/share/ca-certificates/vector_issuing.crt
ADD https://rds-vtc-docker-dev-local.vegistry.vg.vector.int:443/artifactory/rds-build-packages-generic-dev-local/ca-certificates.crt /etc/ssl/certs/ca-certificates.crt
RUN apt-get update && apt-get install -y ca-certificates && chmod 644 /usr/local/share/ca-certificates/* && \
    update-ca-certificates

RUN apt-get install -y wget tzdata && \
    apt-get update -y && \
    apt-get install -y less curl unzip gnupg build-essential && \
    apt-get update -y && \
    apt-get install -y software-properties-common && \
    add-apt-repository ppa:ubuntu-toolchain-r/test && \
    apt-get update -y && \
    apt-get install -y gcc-10 g++-10 && \
    update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-10 10 && \
    update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-10 10 && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

ENV PATH=/opt/rh/devtoolset-10/root/usr/bin:$PATH \
    NODE_EXTRA_CA_CERTS=/usr/local/share/ca-certificates/vector_root.crt \
    SSL_CERT_FILE=/etc/ssl/certs/ca-certificates.crt \
    REQUESTS_CA_BUNDLE=/etc/ssl/certs/ca-certificates.crt \
    SSL_CERT_DIR=/etc/ssl/certs \
    CA_BUNDLE_PATH=/etc/ssl/certs/ca-certificates.crt \
    CURL_CA_BUNDLE=/etc/ssl/certs/ca-certificates.crt \
    GLOBAL_AGENT_HTTP_PROXY=${PROXY_URL} \
    http_proxy=${PROXY_URL} \
    GLOBAL_AGENT_HTTPS_PROXY=${PROXY_URL} \
    GLOBAL_AGENT_NO_PROXY=${NO_PROXY} \
    HTTPS_PROXY=${PROXY_URL} \
    https_proxy=${PROXY_URL} \
    no_proxy=${NO_PROXY} \
    HTTP_PROXY=${PROXY_URL}